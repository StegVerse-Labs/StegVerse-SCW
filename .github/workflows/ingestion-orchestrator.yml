name: Ingestion Orchestrator

on:
  workflow_dispatch:
    inputs:
      master_override:
        description: "Run even if MASTER_INGESTION_ENABLED is false?"
        required: false
        default: "false"

concurrency:
  group: ingestion-orchestrator
  cancel-in-progress: true

env:
  MASTER_INGESTION_ENABLED: ${{ vars.MASTER_INGESTION_ENABLED || 'false' }}

jobs:
  gate:
    runs-on: ubuntu-latest
    outputs:
      proceed: ${{ steps.g.outputs.proceed }}
    steps:
      - id: g
        run: |
          MASTER="${MASTER_INGESTION_ENABLED}"
          OVERRIDE="${{ github.event.inputs.master_override || 'false' }}"
          if [ "$OVERRIDE" = "true" ]; then
            echo "proceed=true" >> "$GITHUB_OUTPUT"
            exit 0
          fi
          if [ "$MASTER" != "true" ]; then
            echo "proceed=false" >> "$GITHUB_OUTPUT"
            exit 0
          fi
          echo "proceed=true" >> "$GITHUB_OUTPUT"

  run:
    needs: gate
    if: ${{ needs.gate.outputs.proceed == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: TODO â€“ Replace with real ingestion steps
        run: |
          echo "Orchestrator ran. Plug your ingestion scripts here."
