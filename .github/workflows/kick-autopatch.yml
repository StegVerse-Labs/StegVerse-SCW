name: Kick StegVerse Autopatch

on:
  workflow_dispatch: {}

jobs:
  kick:
    runs-on: ubuntu-latest
    steps:
      - name: Resolve token
        id: token
        run: |
          if [ -n "${{ secrets.GH_STEGVERSE_PAT }}" ]; then
            echo "token=${{ secrets.GH_STEGVERSE_PAT }}" >> $GITHUB_OUTPUT
          else
            echo "ERROR: Missing GH_STEGVERSE_PAT secret"
            exit 1
          fi

      - name: Dispatch target workflow
        run: |
          set -euo pipefail
          echo "Dispatching auto_patch.yml on StegVerse-Labs/StegVerse-SCW@main"

          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token ${{ steps.token.outputs.token }}" \
            https://api.github.com/repos/StegVerse-Labs/StegVerse-SCW/actions/workflows/auto_patch.yml/dispatches \
            -d '{"ref":"main"}'
