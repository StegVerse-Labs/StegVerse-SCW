name: autopatch

on:
  workflow_dispatch: {}
  # (optional) keep or remove the schedule if you already had one
  # schedule:
  #   - cron: "0 9 * * *"

permissions:
  contents: write
  issues: write
  actions: write

jobs:
  autopatch:
    runs-on: ubuntu-latest

    # ⬇️ This is the key: use PAT_WORKFLOW for all git/gh activity
    env:
      GH_TOKEN: ${{ secrets.PAT_WORKFLOW }}
      GITHUB_TOKEN: ${{ secrets.PAT_WORKFLOW }}

    steps:
      - name: Checkout StegVerse-SCW
        uses: actions/checkout@v4

      - name: Install GitHub CLI
        uses: cli/cli-action@v2
        with:
          version: latest

      - name: Run autopatch across StegVerse repos
        run: |
          set -euo pipefail
          echo "=== StegVerse Autopatch ==="
          python scripts/autopatch_runner.py
        working-directory: .
